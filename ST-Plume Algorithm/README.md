# STPlume Project

## Overview
The STPlume Project processes spatio-temporal events to identify and cluster "plumes" based on spatial zones, temporal windows, and dynamic distance calculations. 
This README outlines the input requirements, configuration options, and output structure.

---

## Folder Structure
The project uses the following folder structure:

```
STPlume_Project/
├── Input/                # Directory for input files
│   ├── events.csv        # Event-level data
│   ├── zones.csv         # Zone definitions
│   ├── zone_links.csv    # Zone-to-zone relationships
├── Output/               # Directory for output files
│   ├── ...               # Generated plume & event files
├── config.json           # Configuration file
├── README.md             # Documentation (this file)
├── main.py               # Main script
├── modules/              # Modular Python scripts
```

---

## Input Files

### 1. Event File (events.csv)
This file contains event-level data, with the following required columns:

|   Column Name    | Description                                                                        |   Data Type         |   Required   |
|------------------|------------------------------------------------------------------------------------|---------------------|--------------|
| `EventID`        | Unique identifier for each event.                                                  | Integer or String   | Yes          |
| `EventDate`      | Date and time of the event (e.g., `YYYY-MM-DD HH:MM:SS`).                          | DateTime            | Yes          |
| `X`              | X-coordinate of the event (longitude or projected coordinate).                     | Float               | Yes          |
| `Y`              | Y-coordinate of the event (latitude or projected coordinate).                      | Float               | Yes          |
| `ZoneID`         | Identifier for the zone where the event occurs. Must match a zone in `zones.csv`.  | String              | Yes          |

#### Notes:
- Ensure   all events have a valid `ZoneID` that corresponds to a zone in the Zone File (`zones.csv`).
- Coordinate system must match that used in the Zone File.

---

### 2.   Zone File (zones.csv)  
This file defines the spatial zones used in the analysis, with the following required columns:

|   Column Name    |   Description                                                               |   Data Type   |   Required   |
|------------------|-----------------------------------------------------------------------------|---------------|--------------|
| `ZoneID`         | Unique identifier for each zone.                                            | String        | Yes          |
| `ZIDX`           | A modifier metric generated by user to determine how to vary spatial        | Double        | Yes          |
|                  | epsilon search based on underlying spatial structure                        |               |              |
---

### 3.   Zone Link File (zone_links.csv)  
This file specifies neighboring zones for each zone. Each row defines a connection between two zones. This project assumes the relationship is bi-directional

|   Column Name    |   Description                                                           |   Data Type   |   Required   |
|------------------|-------------------------------------------------------------------------|---------------|--------------|
| `ZoneID`         | Identifier for the source zone. Matches the `ZoneID` in `zones.csv`.    | String        | Yes          |
| `LinkID`         | Identifier for a neighboring zone. Matches the `ZoneID` in `zones.csv`. | String        | Yes          |
| `LinkDist`       | Euclidean Distance from ZoneID Centroid to LinkID centroid.             | Double        | Yes          |

#### Notes:
- The algorithm assumes these are   bidirectional links   (e.g., if `ZoneA` links to `ZoneB`, `ZoneB` must link back to `ZoneA`).

---

## Configuration File

The `config.json` file controls the pipeline’s parameters and settings.

### Example `config.json`
```json
{
    "input_files": {
        "event_file": "Input/events.csv",
        "zone_file": "Input/zones.csv",
        "zone_link_file": "Input/zone_links.csv"
    },
    "output_directory": "Output/",
    "parameters": {
        "temporal_epsilons": [91, 30, 14],
        "spatial_epsilon": 328,
        "zoneindex_weights": {
            "alpha": 1.0,
            "beta": 1.0,
            "gamma": 1.0
        }
    },
    "greater": 10,
    "output_format": "geojson",
    "logging": {
        "level": "INFO",
        "log_file": "Output/st_plume.log"
    }
}
```

### Config Parameters
|   Field                |   Description                                                                   |   Required   |
|------------------------|---------------------------------------------------------------------------------|--------------|
| `event_file`           | Path to the Event File.                                                         | Yes          |
| `zone_file`            | Path to the Zone File.                                                          | Yes          |
| `zone_link_file`       | Path to the Zone Link File.                                                     | Yes          |
| `output_directory`     | Directory for saving output files.                                              | Yes          |
| `temporal_epsilons`    | List of temporal epsilon values (in days).                                      | Yes          |
| `spatial_epsilon`      | Base spatial epsilon (in feet).                                                 | Yes          |
| `greater`              | Minimum number of events to determine plumes to export                          | Yes          |
| `output_format`        | Output format for plume data (`csv`, `geojson`, `shapefile`, `xml`).            | Yes          |
| `level` (logging)      | Logging level (`DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`).                | Yes          |
| `log_file` (logging)   | Path to the log file.                                                           | Yes          |

---

## Output Files

### Example Outputs
-   Plume Data  : Generated files for each temporal epsilon in the specified output format (e.g., `plumes_91.geojson`), plume id with event count, temporal epsilon, as well as the list of allocated events.
-   Event Data  : The original event.csv with a new columns for associated plume allocations.
-   Log File  : Log messages are written to `st_plume.log` in the output directory.

---

## Validation and Error Handling

1.   Event File  :
   - Ensures all events have a valid `ZoneID`.
   - Validates `EventDate` format and spatial coordinates (`X`, `Y`).

2.   Zone Link File  :
   - Validates that all `ZoneID` and `LinkID` values reference valid zones.

3.   Config File  :
   - Ensures all required fields are present and have valid values.

### Common Errors
-   Missing ZoneID  : "EventID 123 is not assigned to a valid ZoneID."
-   Invalid Links  : "ZoneID A references undefined ZoneID B in zone_links.csv."

---

## How to Run
1. Prepare your input files (`events.csv`, `zones.csv`, `zone_links.csv`) and place them in the `Input` folder.
2. Configure the parameters in `config.json`.
3. Run the main script:
   ```bash
   python main.py
   ```
4. Check the `Output` folder for results.

---
